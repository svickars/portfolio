function handleResize(){windowW=window.innerWidth,windowH=window.innerHeight,windowW>900?large_screen=!0:windowW>650?medium_screen=!0:small_screen=!0,small_screen?(tD={w:windowW-15,h:10},gD={w:windowW-15,h:windowH},step.style("padding-left",.125*windowW+"px").style("padding-right",.125*windowW+"px"),d3.selectAll(".introinner").style("padding-left",.125*windowW+"px").style("padding-right",.125*windowW+"px")):(tD={w:windowW/3,h:10},gD={w:windowW-tD.w-14,h:windowH}),step.style("height",tD.h+"px").style("width",tD.w+"px"),graphic.style("width",gD.w+"px").style("height",gD.h+"px"),d3.selectAll(".introinner").style("width",tD.w+"px"),scroller.resize()}function handleContainerEnter(t){inScroll=!0}function handleContainerExit(t){inScroll=!1}function init(){handleResize(),section1(),window.addEventListener("resize",handleResize)}function section1(){var t=gD.w,e=gD.h;small_screen&&(t=windowW),scale=t+200,t=t-margin.left-margin.right,e=e-margin.top-margin.bottom;var r=d3.select(".map").attr("width",t+margin.left+margin.right).attr("height",e+margin.top+margin.bottom),a=r.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),n=d3.scaleLinear().domain([1,66]).range([.25,.05]),l=d3.geoAlbers().scale(scale).translate([.5*t,.6*e]).precision(.1),o=d3.geoPath().projection(l),i=r.append("defs"),s=i.append("filter").attr("id","glow");s.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation","25").attr("result","blur"),s.append("feColorMatrix").attr("type","matrix").attr("values",".25 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.25 0 ").attr("result","bluralpha"),s.append("feOffset").attr("in","bluralpha").attr("dx",0).attr("dy",0).attr("result","offsetBlur");var c=s.append("feMerge");c.append("feMergeNode").attr("in","offsetBlur"),c.append("feMergeNode").attr("in","SourceGraphic"),d3.json("js/world-continents.json",function(t,e){if(t)throw t;var a=topojson.feature(e,e.objects.continent).features;r.selectAll(".continent").data(a).enter().append("path").attr("class","continent").attr("d",o).style("fill","#ffffff").style("stroke","#ff000000").style("stroke-width",2).style("filter","url(#glow)")}),d3.csv("data/data.csv",function(t,e){function a(t){if(step.classed("is-active",function(e,r){return r===t.index}),0===t.index&&d3.csv("data/cities.csv",function(t,e){if(t)throw t;r.selectAll(".ch1cities").data(e).enter().append("circle").attr("class","ch1cities").attr("cx",function(t){return l(parseCoord(t.lngLat))[0]}).attr("cy",function(t){return l(parseCoord(t.lngLat))[1]}).attr("r",0).style("fill","#333333").transition().duration(500).ease(d3.easeExp).delay(function(t,e){return 10*e}).attr("r",4)}),1===t.index&&d3.selectAll(".ch1cities").transition().duration(500).ease(d3.easeExp).delay(function(t,e){return 10*e}).attr("r",0),t.index>1){d3.selectAll(".ch1cities").remove();var a=t.index-2,i=e[a],s=i;a>0&&(s=e[a-1]);var c=document.getElementById("yearSlider"),h=document.getElementById("yearValue"),y=camelize(i.t1loc),w=countThis(o,y),f="city-"+y+"-"+w,u=parseCoord(i.t1coord),g=parseCoord(i.t2coord),m=parseCoord(i.t3coord),x=parseCoord(i.t4coord),b=parseCoord(s.t1coord);i.t1.length>0&&p.select("."+i.trophySelector).transition().duration(250).attr("x",l(u)[0]-25).attr("y",l(u)[1]-25).style("opacity","1"),"down"===t.direction?(c.value=i.number,h.innerHTML=i.year,i.t1.length>0&&(o.push(y),d.append("circle").attr("class","circle-"+i.number).attr("cx",l(u)[0]).attr("cy",l(u)[1]).attr("r",w+2).style("opacity",n(w)/2).style("fill",i.colour),w>4&&r.append("text").attr("x",l(u)[0]).attr("y",l(u)[1]).attr("class","mapLabel").attr("dx",function(){return"torontoOntario"===y?-10:l(u)[0]>l([-79.0558445,35.9131996])[0]?-10:10}).attr("dy",5).style("text-anchor",function(){return"torontoOntario"===y?"end":l(u)[0]>l([-79.0558445,35.9131996])[0]?"end":"start"}).text(i.t1loc).transition().delay(500).duration(1e3).style("opacity",0).remove())):(c.value=s.number,h.innerHTML=s.year,o.splice(-1,1),d3.selectAll(".circle-"+i.number).remove(),"TRUE"===i.first&&p.select("."+i.trophySelector).transition().duration(250).style("opacity","0"))}}if(t)throw t;for(var o=[],i=0;i<e.length;i++){var s=i+1;d3.select(".scroll__text").append("div").attr("id","step"+s).attr("class","step stepyear-"+e[i].yearFirst).attr("data-step",s).attr("data-scrollama-index",e[i].league+e[i].year).html("<p>"+e[i].sport+e[i].year+" step: "+e[i].number+"</p>")}step=text.selectAll(".step:not(.intro)"),step.style("height",tD.h+"px").style("width",tD.w+"px");for(var c=["NBA","NHL","NFL","MLB","CFL","MLS","volleyball-w","baseball-m","basketball-w","basketball-m","football-m","soccer-w"],d=r.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),p=r.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),i=0;i<c.length;i++)p.append("svg:image").attr("class","trophy trophy-"+c[i]).attr("width",50).attr("height",50).attr("xlink:href","img/icons/"+c[i]+".png").style("opacity",0);d3.select(".trophy-NBA").attr("x",l([-75.1652215,39.9525839])[0]-25).attr("y",l([-75.1652215,39.9525839])[1]-25),d3.select(".trophy-NHL").attr("x",l([-79.3831843,43.653226])[0]-25).attr("y",l([-79.3831843,43.653226])[1]-25),d3.select(".trophy-NFL").attr("x",l([-81.378447,40.7989472999999])[0]-25).attr("y",l([-81.378447,40.7989472999999])[1]-25),d3.select(".trophy-MLB").attr("x",l([-71.0588801,42.3600825])[0]-25).attr("y",l([-71.0588801,42.3600825])[1]-25),d3.select(".trophy-CFL").attr("x",l([-79.3831843,43.653226])[0]-25).attr("y",l([-79.3831843,43.653226])[1]-25),d3.select(".trophy-MLS").attr("x",l([-77.0368707,38.9071923])[0]-25).attr("y",l([-77.0368707,38.9071923])[1]-25),d3.select(".trophy-volleyball-w").attr("x",l([-81.0348144,34.0007104])[0]-25).attr("y",l([-81.0348144,34.0007104])[1]-25),d3.select(".trophy-baseball-m").attr("x",l([-122.272747,37.8715926])[0]-25).attr("y",l([-122.272747,37.8715926])[1]-25),d3.select(".trophy-basketball-m").attr("x",l([-123.0867536,44.0520691])[0]-25).attr("y",l([-123.0867536,44.0520691])[1]-25),d3.select(".trophy-basketball-w").attr("x",l([-79.8742367999999,40.5077792])[0]-25).attr("y",l([-79.8742367999999,40.5077792])[1]-25),d3.select(".trophy-football-m").attr("x",l([-74.6672226,40.3572976])[0]-25).attr("y",l([-74.6672226,40.3572976])[1]-25),d3.select(".trophy-soccer-w").attr("x",l([-79.0558445,35.9131996])[0]-25).attr("y",l([-79.0558445,35.9131996])[1]-25),scroller.setup({container:"#scroll",graphic:".scroll__graphic",text:".scroll__text",step:".scroll__text .step",debug:!1,offset:.33}).onStepEnter(a).onContainerEnter(handleContainerEnter).onContainerExit(handleContainerExit)}),document.getElementById("yearSlider").oninput=function(){var t=this.value;$("html, body").animate({scrollTop:$("#step"+t).offset().top-windowH/3},0)}}function camelize(t){return t.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0==e?t.toLowerCase():t.toUpperCase()}).replace(/\s+/g,"")}function countThis(t,e){var r=-1,a=-1;do{r++,a=t.indexOf(e,a+1)}while(a>=0);return r}function parseCoord(t){return JSON.parse("["+t+"]")[0]}var container=d3.select("#scroll"),graphic=container.select(".scroll__graphic"),text=container.select(".scroll__text"),step=text.selectAll(".step:not(.intro)"),scroller=scrollama(),inScroll=!1,margin={top:0,right:0,bottom:0,left:0},windowW,windowH,large_screen=!1,medium_screen=!1,small_screen=!1,tD,gD;init();