function handleResize(){windowW=window.innerWidth,windowH=window.innerHeight,windowW>900?large_screen=!0:windowW>650?medium_screen=!0:small_screen=!0,small_screen?(tD={w:windowW-15,h:5},gD={w:windowW-15,h:windowH},step.style("padding-left",.125*windowW+"px").style("padding-right",.125*windowW+"px"),d3.selectAll(".introinner").style("padding-left",.125*windowW+"px").style("padding-right",.125*windowW+"px")):(tD={w:windowW/3,h:5},gD={w:windowW-tD.w-14,h:windowH}),step.style("height",tD.h+"px").style("width",tD.w+"px"),graphic.style("width",gD.w+"px").style("height",gD.h+"px"),d3.selectAll(".introinner").style("width",tD.w+"px"),scroller.resize()}function handleContainerEnter(t){inScroll=!0}function handleContainerExit(t){inScroll=!1}function loadData(){queue().defer(d3.json,"js/world-continents.json").defer(d3.json,"js/us.json").defer(d3.json,"js/canada-provinces.json").defer(d3.csv,"data/data.csv").defer(d3.csv,"data/cities.csv").defer(d3.csv,"data/matrix.csv").await(processData)}function processData(t,e,r,a,n,o,l){handleResize(),section1(e,n,o),section2(e,r,a,n,o),window.addEventListener("resize",handleResize)}function section2(t,e,r,a,n){var o=$(".section2").width(),l=$(".section2").height(),s=d3.geoAlbersUsa().translate([o/2,l/2]).scale([750]),i=d3.geoPath().projection(s),c=d3.select(".section2");c.append("path").attr("class","states").datum(topojson.feature(e,e.objects.states)).attr("d",i),c.append("path").attr("class","states").datum(topojson.feature(r,r.objects.canadaprov)).attr("d",i)}function section1(t,e,r){function a(t){if(step.classed("is-active",function(e,r){return r===t.index}),0===t.index&&i.selectAll(".ch1cities").data(r).enter().append("circle").attr("class","ch1cities").attr("cx",function(t){return p(parseCoord(t.lngLat))[0]}).attr("cy",function(t){return p(parseCoord(t.lngLat))[1]}).attr("r",0).style("fill","#333333").transition().duration(500).ease(d3.easeExp).delay(function(t,e){return 10*e}).attr("r",4),1===t.index&&d3.selectAll(".ch1cities").transition().duration(500).ease(d3.easeExp).delay(function(t,e){return 10*e}).attr("r",0),t.index>1){d3.selectAll(".ch1cities").remove();var a=t.index-2,n=e[a],o=n;a>0&&(o=e[a-1]);var c=document.getElementById("yearSlider"),h=document.getElementById("yearValue");l=n.whereToNext,s=n.whereToPrev;var y=camelize(n.t1loc),u=countThis(g,y),f="city-"+y+"-"+u,w=parseCoord(n.t1coord),m=parseCoord(n.t2coord),x=parseCoord(n.t3coord),v=parseCoord(n.t4coord),_=parseCoord(o.t1coord);n.t1.length>0&&D.select("."+n.trophySelector).transition().duration(250).attr("x",p(w)[0]-25).attr("y",p(w)[1]-25).style("opacity","1"),"down"===t.direction?(c.value=n.number,h.innerHTML=n.year,n.t1.length>0&&(g.push(y),b.append("circle").attr("class","circle-"+n.number).attr("cx",p(w)[0]).attr("cy",p(w)[1]).attr("r",u+2).style("opacity",d(u)/2).style("fill",n.colour),u>4&&i.append("text").attr("x",p(w)[0]).attr("y",p(w)[1]).attr("class","mapLabel").attr("dx",function(){return"torontoOntario"===y?-10:p(w)[0]>p([-79.0558445,35.9131996])[0]?-10:10}).attr("dy",5).style("text-anchor",function(){return"torontoOntario"===y?"end":p(w)[0]>p([-79.0558445,35.9131996])[0]?"end":"start"}).text(n.t1loc).transition().delay(500).duration(1e3).style("opacity",0).remove())):(c.value=o.number,h.innerHTML=o.year,g.splice(-1,1),d3.selectAll(".circle-"+n.number).remove(),"TRUE"===n.first&&D.select("."+n.trophySelector).transition().duration(250).style("opacity","0"))}}var n=gD.w,o=gD.h;small_screen&&(n=windowW),scale=n+200,n=n-margin.left-margin.right,o=o-margin.top-margin.bottom;var l=11,s=1,i=d3.select(".map").attr("width",n+margin.left+margin.right).attr("height",o+margin.top+margin.bottom),c=i.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),d=d3.scaleLinear().domain([1,66]).range([.25,.05]),p=d3.geoAlbers().scale(scale).translate([.5*n,.6*o]).precision(.1),h=d3.geoPath().projection(p),y=i.append("defs"),u=y.append("filter").attr("id","glow");u.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation","25").attr("result","blur"),u.append("feColorMatrix").attr("type","matrix").attr("values",".25 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.25 0 ").attr("result","bluralpha"),u.append("feOffset").attr("in","bluralpha").attr("dx",0).attr("dy",0).attr("result","offsetBlur");var f=u.append("feMerge");f.append("feMergeNode").attr("in","offsetBlur"),f.append("feMergeNode").attr("in","SourceGraphic");var w=topojson.feature(t,t.objects.continent).features;i.selectAll(".continent").data(w).enter().append("path").attr("class","continent").attr("d",h).style("fill","#ffffff").style("stroke","#ff000000").style("stroke-width",2).style("filter","url(#glow)");for(var g=[],m=0;m<e.length;m++){title=e[m];var x=m+1;d3.select(".scroll__text").append("div").attr("id","step"+x).attr("class","step stepyear-"+title.yearFirst).attr("data-step",x).attr("data-scrollama-index",title.league+title.year)}step=text.selectAll(".step:not(.intro)"),step.style("height",tD.h+"px").style("width",tD.w+"px"),d3.select("#step1001").style("height",windowH+"px");for(var v=["NBA","NHL","NFL","MLB","CFL","MLS","volleyball-w","baseball-m","basketball-w","basketball-m","football-m","soccer-w"],b=i.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),D=i.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),m=0;m<v.length;m++)D.append("svg:image").attr("class","trophy trophy-"+v[m]).attr("width",50).attr("height",50).attr("xlink:href","img/icons/"+v[m]+".png").style("opacity",0);d3.select(".trophy-NBA").attr("x",p([-75.1652215,39.9525839])[0]-25).attr("y",p([-75.1652215,39.9525839])[1]-25),d3.select(".trophy-NHL").attr("x",p([-79.3831843,43.653226])[0]-25).attr("y",p([-79.3831843,43.653226])[1]-25),d3.select(".trophy-NFL").attr("x",p([-81.378447,40.7989472999999])[0]-25).attr("y",p([-81.378447,40.7989472999999])[1]-25),d3.select(".trophy-MLB").attr("x",p([-71.0588801,42.3600825])[0]-25).attr("y",p([-71.0588801,42.3600825])[1]-25),d3.select(".trophy-CFL").attr("x",p([-79.3831843,43.653226])[0]-25).attr("y",p([-79.3831843,43.653226])[1]-25),d3.select(".trophy-MLS").attr("x",p([-77.0368707,38.9071923])[0]-25).attr("y",p([-77.0368707,38.9071923])[1]-25),d3.select(".trophy-volleyball-w").attr("x",p([-81.0348144,34.0007104])[0]-25).attr("y",p([-81.0348144,34.0007104])[1]-25),d3.select(".trophy-baseball-m").attr("x",p([-122.272747,37.8715926])[0]-25).attr("y",p([-122.272747,37.8715926])[1]-25),d3.select(".trophy-basketball-m").attr("x",p([-123.0867536,44.0520691])[0]-25).attr("y",p([-123.0867536,44.0520691])[1]-25),d3.select(".trophy-basketball-w").attr("x",p([-79.8742367999999,40.5077792])[0]-25).attr("y",p([-79.8742367999999,40.5077792])[1]-25),d3.select(".trophy-football-m").attr("x",p([-74.6672226,40.3572976])[0]-25).attr("y",p([-74.6672226,40.3572976])[1]-25),d3.select(".trophy-soccer-w").attr("x",p([-79.0558445,35.9131996])[0]-25).attr("y",p([-79.0558445,35.9131996])[1]-25),scroller.setup({container:"#scroll",graphic:".scroll__graphic",text:".scroll__text",step:".scroll__text .step",debug:!1,offset:.33}).onStepEnter(a).onContainerEnter(handleContainerEnter).onContainerExit(handleContainerExit),document.getElementById("yearSlider").oninput=function(){var t=this.value;$("html, body").animate({scrollTop:$("#step"+t).offset().top-windowH/3},0)}}function camelize(t){return t.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0==e?t.toLowerCase():t.toUpperCase()}).replace(/\s+/g,"")}function countThis(t,e){var r=-1,a=-1;do{r++,a=t.indexOf(e,a+1)}while(a>=0);return r}function parseCoord(t){return JSON.parse("["+t+"]")[0]}var container=d3.select("#scroll"),graphic=container.select(".scroll__graphic"),text=container.select(".scroll__text"),step=text.selectAll(".step:not(.intro)"),scroller=scrollama(),inScroll=!1,margin={top:0,right:0,bottom:0,left:0},windowW,windowH,large_screen=!1,medium_screen=!1,small_screen=!1,tD,gD;loadData();