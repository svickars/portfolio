!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.scrollama=t()}(this,function(){"use strict";function e(e){for(var t=e.length,n=[],o=0;o<t;o+=1)n.push(e[o]);return n}function t(e){return e instanceof Element?e:"string"==typeof e?document.querySelector(e):null}function n(t,n){return void 0===n&&(n=document),"string"==typeof t?e(n.querySelectorAll(t)):t instanceof NodeList?e(t):t instanceof Array?t:[]}function o(e){return"scrollama__debug-step--"+e.id+"-"+e.i}function r(e){return"scrollama__debug-offset--"+e.id}function i(e){var t=e.id,n=e.i,r=o({id:t,i:n}),i=document.createElement("div");i.setAttribute("id",r+"_above"),i.setAttribute("class","scrollama__debug-step"),i.style.position="fixed",i.style.left="0",i.style.width="100%",i.style.backgroundImage="repeating-linear-gradient(45deg, green 0, green 2px, white 0, white 40px)",i.style.border="2px solid green",i.style.opacity="0.33",i.style.zIndex="9999",i.style.display="none",document.body.appendChild(i);var s=document.createElement("div");s.setAttribute("id",r+"_below"),s.setAttribute("class","scrollama__debug-step"),s.style.position="fixed",s.style.left="0",s.style.width="100%",s.style.backgroundImage="repeating-linear-gradient(135deg, orange 0, orange 2px, white 0, white 40px)",s.style.border="2px solid orange",s.style.opacity="0.33",s.style.zIndex="9999",s.style.display="none",document.body.appendChild(s)}function s(e){var t=e.id,n=e.offsetVal,o=e.stepClass,i=document.createElement("div");i.setAttribute("id",r({id:t})),i.setAttribute("class","scrollama__debug-offset"),i.style.position="fixed",i.style.left="0",i.style.width="100%",i.style.height="0px",i.style.borderTop="2px dashed black",i.style.zIndex="9999";var s=document.createElement("p");s.innerText='".'+o+'" trigger: '+n,s.style.fontSize="12px",s.style.fontFamily="monospace",s.style.color="black",s.style.margin="0",s.style.padding="6px",i.appendChild(s),document.body.appendChild(i)}function c(e){var t=e.id,n=e.offsetVal,o=e.stepEl,r=o[0].getAttribute("class");o.forEach(function(e,n){return i({id:t,i:n})}),s({id:t,offsetVal:n,stepClass:r})}function u(e){var t=e.id,n=e.offsetMargin,o=e.offsetVal,i=r({id:t});document.querySelector("#"+i).style.top=n+"px"}function a(e){var t=e.id,n=e.h,r=e.i,i=e.offsetMargin,s=o({id:t,i:r});document.querySelector("#"+s+"_above").style.height=n+"px",document.querySelector("#"+s+"_below").style.height=n+"px"}function l(e){var t=e.id,n=e.stepOffsetHeight,o=e.offsetMargin,r=e.offsetVal;n.forEach(function(e,n){return a({id:t,h:e,i:n,offsetMargin:o})}),u({id:t,offsetMargin:o})}function f(e){var t=e.id,n=e.index,r=e.state,i=o({id:t,i:n}),s=document.querySelector("#"+i+"_above"),c=document.querySelector("#"+i+"_below"),u="enter"===r?"block":"none";s&&(s.style.display=u),c&&(c.style.display=u)}function d(){function e(){var e="abcdefghijklmnopqrstuv",t=e.length,n=(new Date).getTime();return""+[0,0,0].map(function(n){return e[Math.floor(Math.random()*t)]}).join("")+n}function o(e){var t=0;if(e.offsetParent)do{t+=e.offsetTop,e=e.offsetParent}while(e);return t<0?0:t}function r(){var e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)}function i(e){return+e.getAttribute("data-scrollama-index")}function s(){window.pageYOffset>ce?ue="down":window.pageYOffset<ce&&(ue="up"),ce=window.pageYOffset}function u(){J=window.innerHeight,K=r(),W=Y?Y.getBoundingClientRect():null,G=L*J,Q=F?F.map(function(e){return e.offsetHeight}):[],U=F?F.map(o):[],Z&&X&&k(),ee&&l({id:D,stepOffsetHeight:Q,offsetMargin:G,offsetVal:L})}function a(e){e&&!Z?(X&&k(),Z=!0):e||(z.top&&z.top.disconnect(),z.bottom&&z.bottom.disconnect(),z.stepAbove&&z.stepAbove.forEach(function(e){return e.disconnect()}),z.stepBelow&&z.stepBelow.forEach(function(e){return e.disconnect()}),z.stepProgress&&z.stepProgress.forEach(function(e){return e.disconnect()}),z.viewportAbove&&z.viewportAbove.forEach(function(e){return e.disconnect()}),z.viewportBelow&&z.viewportBelow.forEach(function(e){return e.disconnect()}),Z=!1)}function d(e){for(var t=Math.ceil(e/ne),n=[],o=1/t,r=0;r<t;r++)n.push(r*o);return n}function p(e,t){if("above"===t)for(var n=0;n<e;n++){var o=ie[n];"enter"===o.state&&v(F[n],"down"),"up"===o.direction&&(g(F[n],"down",!1),v(F[n],"down"))}else if("below"===t)for(var r=ie.length-1;r>e;r--){var i=ie[r];"enter"===i.state&&v(F[r],"up"),"down"===i.direction&&(g(F[r],"up",!1),v(F[r],"up"))}}function g(e,t){void 0===t&&(t=!0);var n=i(e),o={element:e,index:n,direction:ue};ie[n].direction=ue,ie[n].state="enter",oe&&t&&"down"===ue&&p(n,"above"),oe&&t&&"up"===ue&&p(n,"below"),j.stepEnter&&"function"==typeof j.stepEnter&&!ae[n]&&(j.stepEnter(o,ie),ee&&f({id:D,index:n,state:"enter"}),re&&(ae[n]=!0)),te&&("down"===ue?h(e,0):h(e,1))}function v(e){var t=i(e),n={element:e,index:t,direction:ue};ie[t].direction=ue,ie[t].state="exit",te&&("down"===ue?h(e,1):h(e,0)),j.stepExit&&"function"==typeof j.stepExit&&(j.stepExit(n,ie),ee&&f({id:D,index:t,state:"exit"}))}function h(e,t){var n=i(e),o={element:e,index:n,progress:t};j.stepProgress&&"function"==typeof j.stepProgress&&j.stepProgress(o)}function b(){var e={direction:ue};se.direction=ue,se.state="enter",j.containerEnter&&"function"==typeof j.containerEnter&&j.containerEnter(e)}function x(){var e={direction:ue};se.direction=ue,se.state="exit",j.containerExit&&"function"==typeof j.containerExit&&j.containerExit(e)}function m(e){s(),e.forEach(function(e){var t=e.isIntersecting,n=e.boundingClientRect,o=e.target,r=n.bottom,s=n.height,c=r-G,u=i(o),a=ie[u];c>=-T&&(t&&"down"===ue&&"enter"!==a.state?g(o,ue):t||"up"!==ue||"enter"!==a.state?!t&&c>=s&&"down"===ue&&"enter"===a.state&&v(o,ue):v(o,ue))})}function w(e){s(),e.forEach(function(e){var t=e.isIntersecting,n=e.boundingClientRect,o=e.target,r=n.bottom,s=n.height,c=r-G,u=i(o),a=ie[u];c>=-T&&c<s&&t&&"up"===ue&&"enter"!==a.state?g(o,ue):c<=T&&!t&&"down"===ue&&"enter"===a.state&&v(o,ue)})}function y(e){s(),e.forEach(function(e){var t=e.isIntersecting,n=e.target,o=i(n),r=ie[o];t&&"down"===ue&&"enter"!==r.state&&"down"!==r.direction&&(g(n,"down"),v(n,"down"))})}function E(e){s(),e.forEach(function(e){var t=e.isIntersecting,n=e.target,o=i(n),r=ie[o];t&&"up"===ue&&"enter"!==r.state&&"up"!==r.direction&&(g(n,"up"),v(n,"up"))})}function A(e){s(),e.forEach(function(e){var t=e.isIntersecting,n=e.intersectionRatio,o=e.boundingClientRect,r=e.target,i=o.bottom,s=i-G;t&&s>=-T&&h(r,+n.toFixed(3))})}function M(e){s();var t=e[0],n=t.isIntersecting,o=t.boundingClientRect,r=o.top;o.bottom>-T&&(n?b(ue):"enter"===se.state&&x(ue))}function I(e){s();var t=e[0],n=t.isIntersecting;t.boundingClientRect.top<T&&(n?b(ue):"enter"===se.state&&x(ue))}function _(){z.top&&z.top.unobserve(N);var e={root:null,rootMargin:J+"px 0px -"+J+"px 0px",threshold:0};z.top=new IntersectionObserver(M,e),z.top.observe(N)}function C(){z.bottom&&z.bottom.unobserve(N);var e={root:null,rootMargin:"-"+W.height+"px 0px "+W.height+"px 0px",threshold:0};z.bottom=new IntersectionObserver(I,e),z.bottom.observe(N)}function O(){z.stepAbove&&z.stepAbove.forEach(function(e){return e.disconnect()}),z.stepAbove=F.map(function(e,t){var n=Q[t],o=-J+G,r=n+"px 0px "+o+"px 0px",i={root:null,rootMargin:r,threshold:0},s=new IntersectionObserver(m,i);return s.observe(e),s})}function P(){z.stepBelow&&z.stepBelow.forEach(function(e){return e.disconnect()}),z.stepBelow=F.map(function(e,t){var n=-G,o=K-J+Q[t]+G,r=n+"px 0px "+o+"px 0px",i={root:null,rootMargin:r,threshold:0},s=new IntersectionObserver(w,i);return s.observe(e),s})}function B(){z.viewportAbove&&z.viewportAbove.forEach(function(e){return e.disconnect()}),z.viewportAbove=F.map(function(e,t){var n=U[t],o=-(J-G+Q[t]),r=n+"px 0px "+o+"px 0px",i={root:null,rootMargin:r,threshold:0},s=new IntersectionObserver(y,i);return s.observe(e),s})}function S(){z.viewportBelow&&z.viewportBelow.forEach(function(e){return e.disconnect()}),z.viewportBelow=F.map(function(e,t){var n=-(G+Q[t]),o=K-U[t]-Q[t]-G,r=n+"px 0px "+o+"px 0px",i={root:null,rootMargin:r,threshold:0},s=new IntersectionObserver(E,i);return s.observe(e),s})}function H(){z.stepProgress&&z.stepProgress.forEach(function(e){return e.disconnect()}),z.stepProgress=F.map(function(e,t){var n=Q[t]-G,o=-J+G,r=n+"px 0px "+o+"px 0px",i=d(Q[t]),s={root:null,rootMargin:r,threshold:i},c=new IntersectionObserver(A,s);return c.observe(e),c})}function k(){B(),S(),O(),P(),te&&H(),N&&Y&&(_(),C())}function q(){F.forEach(function(e,t){return e.setAttribute("data-scrollama-index",t)})}function R(){ie=F.map(function(){return{direction:null,state:null}}),se={direction:null,state:null}}function V(){ee&&c({id:D,stepEl:F,offsetVal:L})}var T=1,j={},z={},N=null,Y=null,F=null,D=null,L=0,G=0,J=0,K=0,Q=null,U=null,W=null,X=!1,Z=!1,ee=!1,te=!1,ne=0,oe=!1,re=!1,ie=null,se=null,ce=-1,ue=null,ae=[],le={};return le.setup=function(o){var r=o.container,i=o.graphic,s=o.step,c=o.offset;void 0===c&&(c=.5);var l=o.progress;void 0===l&&(l=!1);var f=o.threshold;void 0===f&&(f=4);var d=o.debug;void 0===d&&(d=!1);var p=o.order;void 0===p&&(p=!0);var g=o.once;return void 0===g&&(g=!1),D=e(),F=n(s),N=r?t(r):null,Y=i?t(i):null,F.length?(ee=d,te=l,oe=p,re=g,le.offsetTrigger(c),ne=Math.max(1,+f),X=!0,V(),q(),R(),u(),a(!0),le):(console.error("scrollama error: no step elements"),le)},le.resize=function(){return u(),le},le.enable=function(){return a(!0),le},le.disable=function(){return a(!1),le},le.destroy=function(){a(!1),Object.keys(j).forEach(function(e){return j[e]=null}),Object.keys(z).forEach(function(e){return z[e]=null})},le.offsetTrigger=function(e){return e&&(isNaN(e),!0)?(L=Math.min(Math.max(0,e),1),le):L},le.onStepEnter=function(e){return j.stepEnter=e,le},le.onStepExit=function(e){return j.stepExit=e,le},le.onStepProgress=function(e){return j.stepProgress=e,le},le.onContainerEnter=function(e){return j.containerEnter=e,le},le.onContainerExit=function(e){return j.containerExit=e,le},le}return d});